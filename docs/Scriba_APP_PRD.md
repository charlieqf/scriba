# Scriba APP — 产品需求文档（PRD）

**版本：v1.1**  
**作者：系统自动生成（依据原型表格及评审报告）**  
**最后更新：2025-12-09**

---

# 1. 产品概述（Product Overview）

Scriba APP 是一款面向医疗、护理、治疗师等专业人员的 **快速记录 + AI 后处理** 的移动端工具。  
它通过：  
- **社交账号登录 / 系统级身份识别（FaceID 等）**  
- **蓝牙硬件 Badge 自动连接**  
- **“一键录音”快速流程**  
- **AI 智能摘要、结构化记录自动生成**

帮助用户在繁忙的工作场景中，用极低的操作成本完成记录、归档、同步与后处理。

核心价值：  
- 降低手工记录成本  
- 提高记录质量、格式一致性  
- 提供语义级自动摘要与结构化内容  
- 支持合规、安全的数据存储与同步

---

# 2. 用户流程（User Journey）

## 2.1 启动与初始化（Onboarding）

### 流程阶段  
1. 自动社交登录 / 手动注册 → 设置个人资料 → 系统权限确认

### 流程内容  
用户可通过 **Apple / Google / Facebook** 自动登录，或手动输入邮箱注册。  
**MVP 范围**：仅支持个人用户流程，无需机构代码。

### 功能说明  
- 支持第三方快捷登录  
- 允许用户选择角色（影响推荐模板，**注意：用户注册后不可更改角色**）  
- Face ID 可以作为快速登录方式  
- 支持设备级别的权限引导（麦克风、蓝牙、通知）  
- 提供 Onboarding 结束后的新手指引

### 系统逻辑与反馈  
- 登录失败需提示原因  
- 若设备支持 Face ID，建议引导用户开启  
- 若权限被拒绝 → 显示功能受限提示  

---

## 2.2 硬件连接（Home & Connectivity）

### 流程阶段  
一键扫描并连接蓝牙设备 Scriba Badge

### 流程内容  
检测蓝牙开关 → 搜索 Badge → 扫描 RSSI → 最优设备优先连接 → 二次确认 → 完成绑定。

### 功能说明  
- 显示实时信号强度（RSSI）  
- **主 Badge 优先策略**：若扫描到多个设备，优先连接上次绑定的“主 Badge”  
- 支持 Badge 的状态同步：电量、断连提醒等  
- **低电量策略**：电量 < 10% 时提醒充电；电量耗尽前自动切换至手机麦克风录音

### 系统逻辑与反馈  
- 如果 Badge 三次连接失败，提供手动重试  
- 若设备未连接 → APP 内所有录制功能受限（或提示切换手机录音）  
- 断连时需立即提示  
- 连接成功后需显示当前 Badge 状态（电量）  

---

## 2.3 快速录音（Quick Record）

### 流程阶段  
用户进入首页后点击“一键录音”

### 流程内容  
- 自动检测麦克风  
- 自动识别 Badge 音频输入  
- 开始计时  
- 提供暂停/恢复功能  
- 自动保存草稿（**策略：每分钟自动保存**）

### 功能说明  
- 支持后台录音  
- 支持免持录音  
- 录音文件实时写入缓存区  
- **文件命名**：系统自动生成（暂不支持用户自定义）  

### 系统逻辑与反馈  
- 若麦克风权限关闭 → 提示并引导用户开启  
- 若 Badge 音源中断 → 切换到手机麦克风并提示  
- 若空间不足（受限于手机存储） → 阻止录音并提示剩余空间  

---

## 2.4 录音结束与保存

### 流程阶段  
用户手动结束录音后进入“录音结束页”

### 流程内容  
- 展示录音名称（自动生成）  
- 展示录音长度（**上限：受限于电池续航 >6小时**）  
- 提供删除 / 重录 / 保存草稿 / 发送 AI 处理  
- 回放功能：**支持变速播放**，MVP暂不支持分段标记

### 系统逻辑  
- 保存成功后显示 toast  
- 文件写入失败需重试  
- 删除录音需二次确认  
- **本地存储**：文件保留 30 天或用户主动删除（需提醒用户清除历史数据）

---

## 2.5 异常情况处理

常见异常：  
- Badge 断连  
- 麦克风被占用  
- 权限缺失  
- 空间不足  
- App 被系统清理  

系统逻辑：  
- 全局 toast + 持久性标签  
- 重大异常自动 fallback 模式  
- Badge 断连进入降级模式  

---

## 2.6 文件上传与云端同步

- 本地录音缓存  
- WIFI 环境自动上传  
- 上传失败自动重试  
- 后台上传  
- **同步策略**：MVP 按时间顺序自动同步  

---

## 2.7 AI 生成（Post-Process）

- 自动转写（STT）：**OpenAI Whisper (English Only for MVP)**  
- 自动摘要：**目标长度约 300 字**  
- 自动结构化：**通用 SOAP 模板**  
- 关键字段提取  
- 支持人工编辑与版本记录（AI 失败自动回退为人工编辑模式）  
- **部署方式**：纯云端部署

系统逻辑：  
- STT 失败进入人工模式  
- 内容不足需提示  
- 生成过程显示动画  

---

# 3. 功能需求清单（Feature Requirements）

| 序号 | 名称 | 流程阶段 | 流程内容 | 描述 | 系统逻辑与反馈 |
|-----|------|-----------|-----------|--------|----------------|
| 1 | 核心用户旅程 | 启动初始化 | 自动登录、FaceID | 完整帐号体系 | 登录失败提示等 |
| 2 | 硬件连接 | 蓝牙配对 | 扫描/RSSI/连接 | 支持断连 | 重试逻辑 |
| 3 | 快速录音 | 一键录音 | 后台录音 | Badge 优先 | 自动切换麦克风 |
| 4 | 录音结束 | 保存与删除 | 草稿/重录/回放 | 自动标题 | 变速播放 |
| 5 | 异常兜底 | 异常处理 | 权限/空间/断连 | 全局框架 | fallback 模式 |
| 6 | 文件同步 | 上传管理 | 自动上传 | 后台队列 | 可视化进度 |
| 7 | AI 后处理 | Post-Process | STT/Summary | 自动结构化 | STT 失败 fallback |
| 8 | 导出报告 | 分享/导出 | 导出 PDF | PDF 格式 | - |

---

# 4. 视觉规范（Visual Guidelines）

## 4.1 色彩规范
- Teal：医疗、信任  
- Indigo：导航与系统界面  

## 4.2 卡片式设计  
- 大圆角（Rounded-xl/2xl）  
- Drop Shadow  
- Fade-in / Slide-in 动画  

---

# 5. 非功能性需求（NFR）

- **性能**：冷启动 < 1.5 秒  
- **延迟**：录音启动延迟 < 50ms；AI 处理延迟 < 12 秒  
- **可靠性**：上传重试 3 次  
- **安全**：AES-256 加密（HTTPS + 数据库加密）  
- **合规**：符合 **Australia Privacy Act** 要求  
- **日志**：完整日志体系（MVP 暂不需审计日志）  

---

# 6. 硬件技术参数 (Badge Specs)

已确认硬件规格如下：

| 分类 | 参数指标 | 详细信息 |
|-----|----------|---------|
| **基本信息** | 机身尺寸 | 70*25*7mm |
| | 机身重量 | < 13.5g |
| | 机身材质 | PC+ABS |
| | 按键 | 2个（录音按键、开机按键） |
| | 佩戴方式 | 磁吸 |
| **电池信息** | 电池容量 | 300mAh |
| | 充电 | Type-C, 1W, 5V/500mA, < 2小时充满 |
| **网络支持** | 蓝牙 | Bluetooth V5.0 / V4.2 LE (1.5Mbps) |
| **存储信息** | 容量 | 内置 32GB (支持离线缓存) |
| **录音标准** | 麦克风 | -38dB MEMS Microphone |
| | 格式 | OPUS, 16K Sample rate, 16K bitrate |
| | 降噪 | DSP降噪 40dB |
| | 距离 | 5米以内 |
| | AGC | 支持 |
| **工作环境** | 连续工作时长 | > 6小时 |
| | 跌落 | < 1.5m |
| | 安规 | CE/FCC |

---

# 7. 开放问题与决策（Resolved Decisions）

以下为评审阶段确认的关键决策：

1.  **Badge OTA**：MVP 不支持。
2.  **混合部署**：MVP 仅采用云端部署。
3.  **机构端**：MVP 不提供机构管理员端。
4.  **报告导出**：MVP 需支持导出为 **PDF**。
5.  **平台扩展**：MVP 不支持 Apple Watch / WearOS。
6.  **协作功能**：MVP 不支持多人协作。
7.  **系统集成**：MVP 不支持 EMR/EHR 集成。
